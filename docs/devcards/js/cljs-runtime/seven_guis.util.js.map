{"version":3,"sources":["seven_guis/util.cljs"],"mappings":"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","names":["js/seven-guis","js/seven-guis.util","js/seven-guis.util.already-defined-components","seven-guis.util/already-defined-components","cljs.core.atom","seven-guis.util/reload-existent-custom-elements!","name","seq__40742","cljs.core/seq","chunk__40747","count__40748","i__40749","seq__40750","chunk__40751","count__40752","i__40753","temp__5735__auto__","cljs.core/chunked-seq?","c__4556__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","seq__40743","chunk__40744","count__40745","i__40746","to-reload","js/document","new-el","p__40781","map__40782","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","seven-guis.util/define-custom-element!","element-name","view-component","props-to-observe","props-to-reflect","p1__40780#","cljs.core.swap_BANG_","cljs.core.assoc","js/window.customElements.get","attach-shadow","obj","set-reagent-props","reagent.core.atom","render","js/console.log","reagent.dom.render","cljs.core/deref","fexpr__40784","component","js/Reflect.construct","js/HTMLElement","js/Object.defineProperties","cljs.core/clj->js","cljs.core.mapv","cljs.core/name","js/Object.create","cljs.core.into","this","attr-name","old-value","new-value","cljs.core/assoc","cljs.core.keyword","iter__4529__auto__","s__40786","cljs.core/LazySeq","c__4527__auto__","size__4528__auto__","b__40788","cljs.core/chunk-buffer","i__40787","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__40785","cljs.core/cons","cljs.core/rest","prop","val","and__4115__auto__","fexpr__40789","fexpr__40791","cljs.core/set","fexpr__40790","fexpr__40792","js/window.customElements.define"],"sourcesContent":["(ns seven-guis.util\n  (:require\n    [reagent.core]\n    [reagent.dom]\n    ))\n\n(defonce already-defined-components (atom {})) ;; This is used for hot reloading.\n\n(defn- reload-existent-custom-elements! [name]\n  (doseq [to-reload (-> js/document (.getElementsByTagName name))\n          new-el [(-> js/document (.createElement name))]]\n    (-> to-reload (.replaceWith new-el))))\n\n(defn define-custom-element! [{:keys [element-name view-component props-to-observe props-to-reflect]}]\n  (swap! already-defined-components #(assoc % element-name view-component))\n  (if (js/window.customElements.get element-name)\n    (reload-existent-custom-elements! element-name)\n    (let [attach-shadow (fn [^js obj] (do (set! (.-shadow obj) (.attachShadow obj #js {:mode \"open\"})) obj))\n          set-reagent-props (fn [^js obj] (do (set! (.-reagent-atom-props obj) (reagent.core/atom {})) obj))\n          render (fn [^js obj] (do\n                                 (js/console.log \"rendered\")\n                                 (reagent.dom/render [(fn [] [(@already-defined-components element-name) @(.-reagent-atom-props obj)])] (.-shadow obj)) obj))\n          ;; defines the constructor function, which is the \"class\" object used by the customElements api\n          component (fn component []\n                      (-> (js/Reflect.construct js/HTMLElement #js [] component) ;; super()\n                          attach-shadow\n                          set-reagent-props\n                          render))]\n      ;; Static methods\n      (js/Object.defineProperties component #js {:observedAttributes #js {:get #(clj->js (mapv name props-to-observe))}})\n\n      (set! (.-prototype component)\n            ;; establishes prototype hierarchy\n            (js/Object.create (.-prototype js/HTMLElement)\n                              (clj->js\n                                (into {:connectedCallback\n                                       #js {:configurable true\n                                            :value (fn []\n                                                     (this-as this\n                                                              (js/console.log \"Conectado\")))}\n                                       :attributeChangedCallback\n                                       #js {:value (fn [attr-name old-value new-value]\n                                                     (this-as ^js this\n                                                        (swap! (.-reagent-atom-props this) assoc (keyword attr-name) new-value))\n                                                     (js/console.log \"Prop changed\" attr-name old-value new-value))}}\n                                       (for [prop props-to-observe]\n                                         {prop #js {:get (fn []\n                                                           (js/console.log \"get prop\" prop)\n                                                           (this-as this (-> this (.getAttribute (name prop)))))\n                                                    :set (fn [val]\n                                                           (js/console.log \"set val\" prop val)\n                                                           (this-as ^js this\n                                                              (swap! (.-reagent-atom-props this) assoc prop val)\n                                                              (cond\n                                                                (and val ((set props-to-reflect) prop)) (-> this (.setAttribute (name prop) val))\n                                                                ((set props-to-reflect) prop) (-> this (.removeAttribute (name prop))))))}})))))\n\n      ;;finally, defines the component with these values\n      (js/window.customElements.define element-name component))))\n"]}